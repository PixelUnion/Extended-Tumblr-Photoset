/*!
    --------------------------------
    PXU Photoset Extended
    --------------------------------
    + https://github.com/PixelUnion/Extended-Tumblr-Photoset
    + Version 1.3.0
    + Copyright 2012 Pixel Union
    + Licensed under the MIT license
*/
(function(a){a.fn.pxuPhotoset=function(b,e){var d={highRes:true,rounded:"corners",borderRadius:"5px",exif:true,captions:true,gutter:"10px",photoset:".photo-slideshow",photoWrap:".photo-data",photo:".photo"};var c=a.extend(d,b);return this.each(function(){var f=a(this);f.imagesLoaded(function(){var g=f.data("layout");var m=JSON.stringify(g).split("");var q=m.length;var r=[];for(k=1;k<=q;++k){var t=0;for(var h=0;h<k;++h){var s=parseInt(m[h],10);t+=s}var l=parseInt(m[k-1],10);r[k]=Array(k,l,t)}for(var k=1;k<=q;k++){var o;if(k===1){o=0}else{o=r[k-1][2]}f.find(c.photoWrap).slice(o,r[k][2]).addClass("count-"+r[k][1]).wrapAll('<div class="row clearit" />')}a(this).find(".row").css("margin-bottom",c.gutter);a(this).find(c.photoWrap+":not(:first-child) "+c.photo+" img").css("margin-left",c.gutter);Array.min=function(i){return Math.min.apply(Math,i)};function j(i){i.find(".row").each(function(){var y=a(this);var w=y.find(c.photoWrap).length;if(w>0){var p=y.find(c.photo+" img").map(function(){return a(this).height()}).get();var x=Array.min(p);y.height(x).find(c.photo).height(x)}})}j(f);a(window).resize(function(){j(f)});if(c.exif&&c.captions){f.find(c.photoWrap).each(function(){var C=a(this).find("img");var p;var w;if(C.hasClass("exif-yes")){var B=C.data("camera")||"-";var x=C.data("iso")||"-";var y=C.data("aperture")||"-";var i=C.data("exposure")||"-";var z=C.data("focal")||"-";p='<table class="exif"><tr><td colspan="2"><span class="label">Camera</span><br>'+B+'</td></tr><tr><td><span class="label">ISO</span><br>'+x+'</td><td><span class="label">Aperture</span><br>'+y+'</td></tr><tr><td><span class="label">Exposure</span><br>'+i+'</td><td><span class="label">Focal Length</span><br>'+z+"</td></tr></table>"}else{p=""}if(C.hasClass("caption-yes")){var A=C.data("caption");w='<p class="pxu-caption">'+A+"</p>"}else{w=""}if(w!==""||p!==""){a(this).find(".info").append('<div class="pxu-data">'+w+p+'<span class="arrow-down"></span></div>');if(p===""){a(this).find(".pxu-data").addClass("caption-only")}a(this).find("span.info").css("display","block")}})}else{if(c.exif){f.find(c.photoWrap).each(function(){var z=a(this).find("img");if(z.hasClass("exif-yes")){var p=z.data("camera")||"-";var i=z.data("iso")||"-";var A=z.data("aperture")||"-";var y=z.data("exposure")||"-";var x=z.data("focal")||"-";var w='<table class="exif"><tr><td colspan="2"><span class="label">Camera</span><br>'+p+'</td></tr><tr><td><span class="label">ISO</span><br>'+i+'</td><td><span class="label">Aperture</span><br>'+A+'</td></tr><tr><td><span class="label">Exposure</span><br>'+y+'</td><td><span class="label">Focal Length</span><br>'+x+'</td></tr></table><span class="arrow-down"></span>';a(this).find(".info").append('<div class="pxu-data">'+w+"</div>");a(this).find("span.info").css("display","block")}})}else{if(c.captions){f.find(c.photoWrap).each(function(){var i=a(this).find("img");if(i.hasClass("caption-yes")){var p=i.data("caption");var w='<p class="pxu-caption" style="margin:0;">'+p+"</p>";a(this).find(".info").append('<div class="pxu-data caption-only">'+w+'<span class="arrow-down"></span></div>');a(this).find("span.info").css("display","block")}})}}}if(c.highRes){f.find(c.photoWrap).each(function(){var i=a(this).find(".photo img");var p=i.data("highres");i.attr("src",p)})}if(c.rounded=="corners"){var v=f.find(".row");if(q==1){v.find(c.photoWrap+":first-child "+c.photo).css({borderRadius:c.borderRadius+" 0 0 "+c.borderRadius});v.find(c.photoWrap+":last-child "+c.photo).css({borderRadius:"0 "+c.borderRadius+" "+c.borderRadius+" 0"})}else{for(var u=0;u<q;u++){var n;if(u===0){n=v.eq(u).find(c.photo).size();if(n==1){v.eq(u).find(c.photo).css({borderRadius:c.borderRadius+" "+c.borderRadius+" 0 0"})}else{v.eq(u).find(c.photoWrap+":first-child "+c.photo).css({borderRadius:c.borderRadius+" 0 0 0"});v.eq(u).find(c.photoWrap+":last-child "+c.photo).css({borderRadius:"0 "+c.borderRadius+" 0 0"})}}if(u==q-1){n=v.eq(u).find(c.photo).size();if(n==1){v.eq(u).find(c.photo).css({borderRadius:"0 0 "+c.borderRadius+" "+c.borderRadius})}else{v.eq(u).find(c.photoWrap+":first-child "+c.photo).css({borderRadius:"0 0 0 "+c.borderRadius});v.eq(u).find(c.photoWrap+":last-child "+c.photo).css({borderRadius:"0 0 "+c.borderRadius+" 0"})}}}}}if(c.rounded=="all"){f.find(c.photo).css({borderRadius:c.borderRadius})}if(!c.rounded){f.find(c.photo).css({borderRadius:0})}f.addClass("processed");if(typeof e=="function"){e.call(this)}});a(c.photoWrap).on("mouseenter",function(){a(this).find(".icons").css("visibility","visible")}).on("mouseleave",function(){a(this).find(".icons").css("visibility","hidden")});a("span.info").on("mouseenter",function(){var g=a(this);var h=g.children(".pxu-data");h.css("display","block").stop(true,false).animate({opacity:1},200)});a("span.info").on("mouseleave",function(){var g=a(this);var h=g.children(".pxu-data");h.stop(true,false).animate({opacity:0},200,function(){a(this).css("display","none")})})})}})(jQuery);